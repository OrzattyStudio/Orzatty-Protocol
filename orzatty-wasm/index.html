<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Orzatty Protocol - Browser Invasion</title>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            background: #1a1a1a;
            color: #fff;
            padding: 2rem;
        }

        .hero {
            text-align: center;
            margin-bottom: 2rem;
        }

        .hero h1 {
            font-size: 3rem;
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .status {
            padding: 1rem;
            border-radius: 8px;
            background: #333;
            margin-bottom: 1rem;
        }

        button {
            padding: 10px 20px;
            font-size: 1.2rem;
            cursor: pointer;
            background: #4ECDC4;
            border: none;
            border-radius: 5px;
            color: #000;
            font-weight: bold;
        }

        #log {
            margin-top: 1rem;
            font-family: monospace;
            color: #aaa;
            max-height: 400px;
            overflow-y: auto;
            background: #000;
            padding: 1rem;
            border: 1px solid #444;
        }
    </style>
</head>

<body>
    <div class="hero">
        <h1>Orzatty Protocol</h1>
        <p>Native Browser Client (WASM + WebTransport)</p>
    </div>

    <div class="status">
        <p>Status: <span id="connStatus" style="color: yellow">Disconnected</span></p>
        <button id="btnConnect">Connect to Server</button>
        <button id="btnPing" disabled>Send Ping</button>
    </div>

    <div id="log">Logs will appear here...<br></div>

    <script type="module">
        import init, { OrzattyWasmClient } from './pkg/orzatty_wasm.js';

        const logDiv = document.getElementById('log');
        function log(msg) {
            const time = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${time}] ${msg}<br>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        async function main() {
            log("Initializing WASM...");
            await init();
            log("WASM Ready.");

            document.getElementById('btnConnect').onclick = async () => {
                log("Connecting via WebTransport...");
                document.getElementById('connStatus').innerText = "Connecting...";

                try {
                    // Note: Chrome requires HTTPS for WebTransport (even localhost usually)
                    // Or specific flags. Ideally server runs on https://127.0.0.1:5000
                    const client = await OrzattyWasmClient.connect("https://127.0.0.1:5000", "SECRET_TOKEN_123");

                    document.getElementById('connStatus').innerText = "Connected üöÄ";
                    document.getElementById('connStatus').style.color = "#4ECDC4";
                    document.getElementById('btnConnect').disabled = true;
                    document.getElementById('btnPing').disabled = false;

                    log("Connected successfully!");

                    // Setup listener (hypothetical API)
                    client.on(1, (data) => {
                        const text = new TextDecoder().decode(data);
                        log(`Received on Ch 1: ${text}`);
                    });

                    document.getElementById('btnPing').onclick = async () => {
                        const msg = "Hello from Chrome!";
                        const bytes = new TextEncoder().encode(msg);
                        await client.send(1, bytes);
                        log("Sent: " + msg);
                    };

                } catch (e) {
                    log("Connection Failed: " + e);
                    document.getElementById('connStatus').innerText = "Error ‚ùå";
                    document.getElementById('connStatus').style.color = "red";
                    console.error(e);
                }
            };
        }

        main();
    </script>
</body>

</html>